<?xml version="1.0" encoding="UTF-8"?>
<cspec xmlns="http://www.eclipse.org/buckminster/CSpec-1.0" name="org.eclipse.buckminster" version="0.1.0" versionType="OSGi">
	<dependencies>
 		<dependency name="org.eclipse.buckminster.update" category="feature"/>
		<dependency name="org.eclipse.buckminster.product" category="feature"/>
		<dependency name="org.eclipse.buckminster.jnlp.product" category="feature"/>
		<dependency name="org.eclipse.buckminster.jnlp.bootstrap"/>
		<dependency name="commons-net"/>
	</dependencies>

	<actions>
		<public name="build.site" actor="ant">
			<actorProperties>
				<property key="buildFile" value="make/build.xml" />
			</actorProperties>
			<prerequisites>
				<attribute name="site.source" alias="site"/>
				<attribute component="org.eclipse.buckminster.update" name="feature.xml" alias="site.feature.xml"/>
			</prerequisites>
            <products base="${buckminster.output}/site" upToDatePolicy="COUNT" fileCount="1"/>
		</public>

		<public name="normalize.site" actor="ant">
			<actorProperties>
				<property key="buildFile" value="make/eclipse-signing.ant" />
				<property key="targets" value="normalize.jars" />
			</actorProperties>
			<prerequisites>
				<attribute name="build.site" alias="requirement"/>
			</prerequisites>
            <products base="${buckminster.output}/normalized.site" alias="product.output" upToDatePolicy="MAPPER"/>
		</public>

		<public name="sign.site" actor="ant">
			<actorProperties>
				<property key="buildFile" value="make/eclipse-signing.ant" />
				<property key="targets" value="sign.jars" />
			</actorProperties>
			<prerequisites>
				<attribute name="normalize.site" alias="requirement"/>
			</prerequisites>
            <products base="${buckminster.output}/signed.site" alias="product.output" upToDatePolicy="MAPPER"/>
		</public>

		<public name="build.product" actor="ant">
			<actorProperties>
				<property key="buildFile" value="make/build.xml" />
				<property key="targets" value="build.product" />
			</actorProperties>
			<properties>
				<property key="product.name" value="buckminster.product" />
			</properties>
			<prerequisites>
				<attribute component="org.eclipse.buckminster.product" name="create.buckminster.product" alias="product"/>
				<attribute component="org.eclipse.buckminster.product" name="feature.xml" alias="product.feature.xml"/>
			</prerequisites>
            <products base="${buckminster.output}/product" alias="product.output" upToDatePolicy="COUNT" fileCount="1"/>
		</public>

		<public name="normalize.product" actor="ant">
			<actorProperties>
				<property key="buildFile" value="make/eclipse-signing.ant" />
				<property key="targets" value="normalize.jars" />
			</actorProperties>
			<prerequisites>
				<attribute name="build.product" alias="requirement"/>
			</prerequisites>
            <products base="${buckminster.output}/normalized.product" alias="product.output" upToDatePolicy="MAPPER"/>
		</public>

		<public name="sign.product" actor="ant">
			<actorProperties>
				<property key="buildFile" value="make/eclipse-signing.ant" />
				<property key="targets" value="sign.jars" />
			</actorProperties>
			<prerequisites>
				<attribute name="normalize.product" alias="requirement"/>
			</prerequisites>
            <products base="${buckminster.output}/signed.product" alias="product.output" upToDatePolicy="MAPPER"/>
		</public>

		<public name="build.jnlp.installer" actor="ant">
			<actorProperties>
				<property key="buildFile" value="make/build.xml" />
				<property key="targets" value="build.product" />
			</actorProperties>
			<properties>
				<property key="product.name" value="buckminster.jnlp.installer" />
			</properties>
			<prerequisites>
				<attribute component="org.eclipse.buckminster.jnlp.product" name="jnlp.installer" alias="product"/>
				<attribute component="org.eclipse.buckminster.jnlp.product" name="feature.xml" alias="product.feature.xml"/>
			</prerequisites>
            <products base="${buckminster.output}/jnlp.installer" alias="product.output" upToDatePolicy="COUNT" fileCount="1"/>
		</public>

		<public name="normalize.jnlp.installer" actor="ant">
			<actorProperties>
				<property key="buildFile" value="make/eclipse-signing.ant" />
				<property key="targets" value="normalize.jars" />
			</actorProperties>
			<prerequisites>
				<attribute name="build.jnlp.installer" alias="requirement"/>
			</prerequisites>
            <products base="${buckminster.output}/normalized.jnlp.installer" alias="product.output" upToDatePolicy="MAPPER"/>
		</public>

		<public name="sign.jnlp.installer" actor="ant">
			<actorProperties>
				<property key="buildFile" value="make/eclipse-signing.ant" />
				<property key="targets" value="sign.jars" />
			</actorProperties>
			<prerequisites>
				<attribute name="normalize.jnlp.installer" alias="requirement"/>
			</prerequisites>
            <products base="${buckminster.output}/signed.jnlp.installer" alias="product.output" upToDatePolicy="MAPPER"/>
		</public>

		<public name="pack.jnlp.installer" actor="ant">
			<actorProperties>
				<property key="buildFile" value="make/eclipse-signing.ant" />
				<property key="targets" value="pack.jars" />
			</actorProperties>
			<prerequisites>
				<attribute name="sign.jnlp.installer" alias="requirement"/>
			</prerequisites>
            <products base="${buckminster.output}/packed.jnlp.installer" alias="product.output" upToDatePolicy="MAPPER"/>
		</public>

		<public name="publish.jnlp.installer" actor="ant">
			<actorProperties>
				<property key="buildFile" value="make/publish.ant" />
				<property key="targets" value="ftp.publish" />
			</actorProperties>
			<prerequisites>
				<attribute name="pack.jnlp.installer" alias="requirement"/>
				<attribute component="commons-net" name="java.binaries" alias="commons-net.classpath"/>
			</prerequisites>
 		</public>

		<public name="pack.jnlp.product" actor="ant">
			<actorProperties>
				<property key="buildFile" value="make/eclipse-signing.ant" />
				<property key="targets" value="pack.jars" />
			</actorProperties>
			<prerequisites>
				<attribute name="build.jnlp.installer" alias="requirement"/>
			</prerequisites>
            <products base="${buckminster.output}/packed.jnlp.product" alias="product.output" upToDatePolicy="MAPPER"/>
		</public>

		<public name="wrap.jnlp.product" actor="ant">
			<actorProperties>
				<property key="buildFile" value="make/build.xml" />
			</actorProperties>
			<prerequisites>
				<attribute name="pack.jnlp.product" alias="installer.zip"/>
				<attribute component="org.eclipse.buckminster.jnlp.bootstrap" name="product.binary.folder" alias="installer.classes"/>
			</prerequisites>
            <products base="${buckminster.output}/wrapped.jnlp.product" alias="product.output" upToDatePolicy="NOT_EMPTY"/>
		</public>

		<public name="build.jnlp.package" actor="ant">
			<actorProperties>
				<property key="buildFile" value="make/build.xml" />
			</actorProperties>
			<prerequisites>
				<attribute component="org.eclipse.buckminster.jnlp.bootstrap" name="java.binary.archive" alias="bootstrap.jar"/>
				<attribute name="wrap.jnlp.product" alias="product.jars"/>
			</prerequisites>
            <products base="${buckminster.output}/" alias="product.output" upToDatePolicy="COUNT" fileCount="1">
            	<path path="jnlp-package.zip"/>
            </products>
		</public>

		<public name="sign.jnlp.package" actor="ant">
			<actorProperties>
				<property key="buildFile" value="make/eclipse-signing.ant" />
				<property key="targets" value="sign.jars" />
			</actorProperties>
			<prerequisites>
				<attribute name="build.jnlp.package" alias="requirement"/>
			</prerequisites>
            <products base="${buckminster.output}/signed.jnlp.package" alias="product.output" upToDatePolicy="MAPPER"/>
		</public>

		<public name="clean" actor="ant">
			<actorProperties>
				<property key="buildFile" value="make/build.xml" />
			</actorProperties>
			<prerequisites>
				<attribute component="org.eclipse.buckminster.product" name="buckminster.clean"/>
				<attribute component="org.eclipse.buckminster.jnlp.product" name="buckminster.clean"/>
				<attribute component="org.eclipse.buckminster.update" name="buckminster.clean"/>
			</prerequisites>
		</public>
	</actions>

	<groups>
		<public name="build.all">
			<attribute name="build.site"/>
			<attribute name="build.product"/>
			<attribute name="build.jnlp.installer"/>
		</public>
		<public name="sign.all">
			<attribute name="sign.site"/>
			<attribute name="sign.product"/>
			<attribute name="sign.jnlp.installer"/>
		</public>
		<private name="site.source">
			<attribute component="org.eclipse.buckminster.update" name="feature.exports"/>
			<attribute component="org.eclipse.buckminster.update" name="site.files"/>
		</private>
 	</groups>
</cspec>
