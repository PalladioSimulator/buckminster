<?xml version="1.0" encoding="UTF-8"?>
<!-- 
	Copyright (c) 2006-2007, Cloudsmith Inc.
	The code, documentation and other materials contained herein have been
	licensed under the Eclipse Public License - v 1.0 by the copyright holder
	listed above, as the Initial Contributor under such license. The text of
	such license is available at www.eclipse.org.
-->
<project name="org.eclipse.buckminster.pde.misc">

	<target name="create.output.dir">
		<dirname property="output.dir" file="${sp:action.output}"/>
		<mkdir dir="${output.dir}"/>
	</target>

	<target name="create.jar" depends="create.output.dir">
		<buckminster.jar jarfile="${sp:action.output}">
			<buckminster.filesetgroup value="${fs:action.requirements}"/>
		</buckminster.jar>
	</target>

	<target name="create.jar.with.manifest" depends="create.output.dir">
		<buckminster.jar jarfile="${sp:action.output}" manifest="${buckminster.jar.manifest}" duplicate="preserve">
			<buckminster.filesetgroup value="${fs:action.requirements}"/>
		</buckminster.jar>
	</target>

	<target name="create.zip" depends="create.output.dir">
		<buckminster.zip zipfile="${sp:action.output}">
			<buckminster.filesetgroup value="${fs:action.requirements}"/>
		</buckminster.zip>
	</target>

	<target name="create.eclipse.product">
		<mkdir dir="${sp:action.output}"/>
		<buckminster.createProductBase
			productFile="${buckminster.eclipse.productFile}"
			outputDir="${sp:action.output}"/>

		<buckminster.copy todir="${sp:action.output}" overwrite="true">
			<buckminster.filesetgroup value="${fs:action.requirements}"/>
		</buckminster.copy>

		<buckminster.convertSiteToRuntime sitedir="${sp:action.output}"/>

		<buckminster.multichmod dir="${sp:action.output}">
			<propertyset>
				<propertyref prefix="buckminster.install.permissions."/>
			</propertyset>
		</buckminster.multichmod>
	</target>

	<target name="create.eclipse.jnlp.product" depends="create.eclipse.product">
		<buckminster.jnlpSiteGenerator sitedir="${sp:action.output}"/>
	</target>

	<target name="create.packed.feature" depends="create.output.dir">
		<buckminster.copy todir="${feature.dir}">
			<buckminster.filesetgroup value="${fs:feature.contents}"/>
		</buckminster.copy>
		<buckminster.valuepath value="${fs:referenced.artifacts}" id="referenced.artifacts"/>
		<buckminster.consolidateFeature featureFile="${feature.dir}/feature.xml">
			<featureAndPluginPath refid="referenced.artifacts"/>
		</buckminster.consolidateFeature>
		<jar jarfile="${sp:action.output}" basedir="${feature.dir}"/>
		<delete includeemptydirs="true" dir="${feature.dir}"/>
	</target>

	<target name="copy.group">
		<mkdir dir="${sp:action.output}"/>
		<buckminster.copy todir="${sp:action.output}" overwrite="true">
			<buckminster.filesetgroup value="${fs:action.requirements}"/>
		</buckminster.copy>
	</target>

	<target name="delete.group">
		<buckminster.delete>
			<buckminster.filesetgroup value="${fs:action.requirements}"/>
		</buckminster.delete>
	</target>

	<target name="delete.dir">
		<delete dir="${dir.to.delete}" includeemptydirs="true"/>
	</target>

	<target name="delete.file">
		<delete file="${file.to.delete}"/>
	</target>

	<target name="unzip" depends="create.output.dir">
		<pathconvert property="zip.input.file">
			<buckminster.valuefileset value="${fs:action.requirements}"/>
		</pathconvert>
		<unzip dest="${sp:action.output}" src="${zip.input.file}"/>
	</target>

	<target name="unjar.named" depends="create.output.dir">
		<pathconvert property="jar.input.file">
			<buckminster.valuefileset value="${fs:action.requirements}"/>
		</pathconvert>
		<basename property="jar.output.folder" file="${jar.input.file}" suffix=".jar"/>		
		<unjar dest="${jar.output.folder}" src="${jar.input.file}"/>
	</target>
</project>
